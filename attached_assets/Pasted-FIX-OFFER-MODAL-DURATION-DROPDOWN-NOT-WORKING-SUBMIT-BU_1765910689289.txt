FIX OFFER MODAL - DURATION DROPDOWN NOT WORKING + SUBMIT BUTTON BROKEN

The Make Offer modal has three issues:
1. The "Offer Duration" dropdown doesn't open or work when clicked
2. The Submit button is too dim and hard to see
3. The Submit button does nothing when clicked - appears dead

=== FIX IN: components/EscrowMarketplace.tsx ===

Find the OfferModal component (around line 1613) and REPLACE the entire OfferModal function with this fixed version:

// Offer Modal Component - FIXED VERSION
function OfferModal({ isOpen, onClose, item, onSubmit }: { isOpen: boolean, onClose: () => void, item: MarketItem | null, onSubmit: (amount: number, duration: string) => void }) {
    const [amount, setAmount] = useState<number>(0);
    const [duration, setDuration] = useState("7");  // Store as days number string for easier parsing
    const [isValidating, setIsValidating] = useState(false);
    const [validationError, setValidationError] = useState<string | null>(null);
    const { isConnected, address } = useAccount();
    const chainId = useChainId();
    const { switchChain } = useSwitchChain();
    const { toast } = useToast();
    const { openConnectModal } = useConnectModal();
    
    // Real wallet balance
    const [walletBalance, setWalletBalance] = useState<number | null>(null);
    const [balanceLoading, setBalanceLoading] = useState(false);
    
    const GAS_BUFFER = 100; // Reserve for gas fees
    const maxOffer = walletBalance ? Math.max(0, walletBalance - GAS_BUFFER) : 0;
    const canAfford = walletBalance !== null && amount > 0 && amount <= maxOffer;
    const insufficientFunds = walletBalance !== null && amount > maxOffer;
    
    // Duration options with display labels
    const durationOptions = [
        { value: "1", label: "1 Day" },
        { value: "3", label: "3 Days" },
        { value: "7", label: "1 Week" },
        { value: "30", label: "1 Month" },
        { value: "90", label: "3 Months" },
        { value: "365", label: "1 Year" },
    ];
    
    const getDurationLabel = (value: string) => {
        return durationOptions.find(opt => opt.value === value)?.label || "1 Week";
    };
    
    // Fetch wallet balance when modal opens
    useEffect(() => {
        if (isOpen && isConnected && address) {
            setBalanceLoading(true);
            const fetchBalance = async () => {
                try {
                    const { ethers } = await import('ethers');
                    const provider = new ethers.JsonRpcProvider('https://mainnet.basedaibridge.com/rpc/', {
                        chainId: 32323,
                        name: 'BasedAI'
                    });
                    const balanceWei = await provider.getBalance(address);
                    const balance = parseFloat(ethers.formatEther(balanceWei));
                    setWalletBalance(balance);
                } catch (error) {
                    console.error('[OfferModal] Failed to fetch balance:', error);
                    setWalletBalance(null);
                } finally {
                    setBalanceLoading(false);
                }
            };
            fetchBalance();
        }
    }, [isOpen, isConnected, address]);
    
    // Reset when item changes
    useEffect(() => {
        if (item) {
            setAmount(item.price ? Math.floor(item.price * 0.9) : 1000);
            setDuration("7");
            setValidationError(null);
        }
    }, [item]);

    // Check chain on open
    useEffect(() => {
        if (isOpen && isConnected && chainId !== 32323) {
            toast({
                title: "Wrong Network",
                description: "Please switch to BasedAI Network to make offers.",
                duration: 6000,
            });
        }
    }, [isOpen, isConnected, chainId, toast]);
    
    const handleSubmit = async () => {
        console.log('[OfferModal] Submit clicked', { isConnected, amount, walletBalance, canAfford });
        
        // Clear previous errors
        setValidationError(null);
        
        // Check wallet connection
        if (!isConnected) {
            setValidationError('Please connect your wallet first');
            toast({ title: "Connect Wallet", description: "Please connect your wallet to make an offer", variant: "destructive" });
            openConnectModal?.();
            return;
        }
        
        // Check network
        if (chainId !== 32323) {
            setValidationError('Please switch to BasedAI Network');
            switchChain?.({ chainId: 32323 });
            return;
        }
        
        // Check amount
        if (!amount || amount <= 0) {
            setValidationError('Please enter an offer amount greater than 0');
            return;
        }
        
        // Check balance loaded
        if (walletBalance === null) {
            setValidationError('Could not verify wallet balance. Please try again.');
            return;
        }
        
        // Check sufficient funds
        if (amount > maxOffer) {
            setValidationError(`Insufficient balance. Maximum offer: ${maxOffer.toLocaleString()} $BASED (keeping ${GAS_BUFFER} for gas)`);
            return;
        }
        
        console.log('[OfferModal] Validation passed, submitting offer...');
        setIsValidating(true);
        
        try {
            // Convert duration from days string to human-readable format for the callback
            const durationLabel = getDurationLabel(duration);
            await onSubmit(amount, durationLabel);
            // Don't close here - let the parent handle success
        } catch (error) {
            console.error('[OfferModal] Submit error:', error);
            setValidationError('Failed to submit offer. Please try again.');
        } finally {
            setIsValidating(false);
        }
    };
    
    const setMaxOffer = () => {
        if (maxOffer > 0) {
            setAmount(Math.floor(maxOffer));
            setValidationError(null);
        }
    };

    if (!item) return null;

    // Determine if button should be clickable
    const isButtonDisabled = !isConnected || balanceLoading || isValidating;
    const showWarning = isConnected && !canAfford && amount > 0 && !balanceLoading;

    return (
        <Dialog open={isOpen} onOpenChange={onClose} modal={true}>
            <DialogContent 
                className="bg-black/95 backdrop-blur-xl border-cyan-500/30 text-white w-full h-full sm:h-auto sm:max-w-md sm:rounded-xl overflow-y-auto"
                style={{ zIndex: 99999 }}
            >
                <DialogHeader className="pt-8 sm:pt-0">
                    <DialogTitle className="font-orbitron text-xl flex items-center gap-2">
                        <Gavel className="text-cyan-400" size={20} />
                        MAKE AN OFFER
                    </DialogTitle>
                    <DialogDescription className="text-gray-400">
                        Set your price for <span className="text-cyan-400 font-bold">{Security.sanitizeText(item.name)}</span>
                    </DialogDescription>
                </DialogHeader>

                <div className="space-y-6 py-4">
                    {/* Amount Input */}
                    <div className="space-y-2">
                        <Label className="text-xs text-cyan-400/70 uppercase font-mono tracking-wider">OFFER AMOUNT ($BASED)</Label>
                        <div className="flex gap-2">
                             <Input 
                                type="text"
                                inputMode="numeric"
                                pattern="[0-9]*"
                                value={amount || ''} 
                                onChange={(e) => {
                                    const val = e.target.value.replace(/^0+/, '').replace(/[^0-9]/g, '');
                                    setAmount(val ? parseInt(val, 10) : 0);
                                    setValidationError(null);
                                }}
                                className={`bg-white/5 border-white/20 text-white font-mono text-lg focus:border-cyan-500/50 focus:ring-cyan-500/20 ${insufficientFunds ? 'border-red-500/50' : ''}`}
                                placeholder="Enter amount..."
                                data-testid="offer-amount-input"
                             />
                             <Button 
                                variant="outline" 
                                size="sm" 
                                onClick={setMaxOffer}
                                disabled={!walletBalance || maxOffer <= 0}
                                className="bg-cyan-500/10 border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/20 hover:border-cyan-400 font-mono text-xs px-4 h-10"
                                data-testid="max-offer-btn"
                             >
                                MAX
                             </Button>
                        </div>
                        <div className="flex justify-between text-[10px] text-muted-foreground">
                            <span data-testid="offer-balance-display">
                                {balanceLoading ? (
                                    <span className="animate-pulse">Loading balance...</span>
                                ) : walletBalance !== null ? (
                                    <>Balance: <span className={insufficientFunds ? 'text-red-400' : 'text-emerald-400'}>{walletBalance.toLocaleString()}</span> $BASED</>
                                ) : isConnected ? (
                                    'Could not load balance'
                                ) : (
                                    'Connect wallet to see balance'
                                )}
                            </span>
                            <span>
                                {walletBalance !== null && (
                                    <>Max: {maxOffer.toLocaleString()} $BASED</>
                                )}
                            </span>
                        </div>
                    </div>
                    
                    {/* Validation Error */}
                    {validationError && (
                        <div className="p-3 rounded-lg bg-red-500/10 border border-red-500/30 flex items-start gap-2 animate-shake" data-testid="offer-validation-error">
                            <AlertTriangle size={16} className="text-red-400 flex-shrink-0 mt-0.5" />
                            <span className="text-xs text-red-300">{validationError}</span>
                        </div>
                    )}
                    
                    {/* Insufficient Funds Warning */}
                    {showWarning && !validationError && (
                        <div className="p-3 rounded-lg bg-amber-500/10 border border-amber-500/30 flex items-start gap-2" data-testid="insufficient-funds-warning">
                            <AlertTriangle size={16} className="text-amber-400 flex-shrink-0 mt-0.5" />
                            <div className="text-xs text-amber-300">
                                <p className="font-semibold">Insufficient Balance</p>
                                <p>You need {(amount - (walletBalance || 0)).toLocaleString()} more $BASED</p>
                            </div>
                        </div>
                    )}

                    {/* Duration Select - FIXED with proper z-index */}
                    <div className="space-y-2">
                        <Label className="text-xs text-cyan-400/70 uppercase font-mono tracking-wider">OFFER DURATION</Label>
                        <Select value={duration} onValueChange={(val) => { console.log('[OfferModal] Duration changed:', val); setDuration(val); }}>
                            <SelectTrigger 
                                className="bg-white/5 border-white/20 text-white hover:bg-white/10 hover:border-cyan-500/50 focus:border-cyan-500/50 focus:ring-cyan-500/20 h-12"
                                data-testid="duration-select-trigger"
                            >
                                <div className="flex items-center gap-2">
                                    <Timer size={16} className="text-cyan-400" />
                                    <SelectValue placeholder="Select duration">{getDurationLabel(duration)}</SelectValue>
                                </div>
                            </SelectTrigger>
                            <SelectContent 
                                className="bg-black/95 backdrop-blur-xl border-cyan-500/30 text-white"
                                style={{ zIndex: 999999 }}
                                position="popper"
                                sideOffset={4}
                            >
                                {durationOptions.map((opt) => (
                                    <SelectItem 
                                        key={opt.value} 
                                        value={opt.value}
                                        className="text-white hover:bg-cyan-500/20 focus:bg-cyan-500/20 cursor-pointer py-3"
                                    >
                                        {opt.label}
                                    </SelectItem>
                                ))}
                            </SelectContent>
                        </Select>
                    </div>

                    {/* Gas Estimate */}
                    <div className="p-3 rounded-lg bg-white/5 border border-white/10 flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <Flame size={14} className="text-orange-500" />
                            <span className="text-xs text-muted-foreground">Est. Gas Fee</span>
                        </div>
                        <div className="text-right">
                            <span className="text-xs font-mono text-white">~0.002 $BASED</span>
                        </div>
                    </div>
                    
                    {/* Important Disclaimer */}
                    <div className="p-3 rounded-lg bg-cyan-500/5 border border-cyan-500/20">
                        <p className="text-[10px] text-cyan-200/80 text-center">
                            <strong>ℹ️ Note:</strong> Your $BASED is <strong>NOT locked</strong> until seller accepts. 
                            Maintain sufficient balance when seller accepts.
                        </p>
                    </div>
                </div>

                <DialogFooter className="flex gap-3 sm:gap-3 flex-col sm:flex-row pb-6 sm:pb-0">
                    <Button 
                        variant="ghost" 
                        onClick={onClose} 
                        className="flex-1 w-full border border-white/20 text-white hover:bg-white/10 h-12"
                    >
                        CANCEL
                    </Button>
                    <Button 
                        onClick={handleSubmit} 
                        disabled={isButtonDisabled}
                        className={`flex-1 w-full font-bold font-orbitron h-12 text-base transition-all duration-300 ${
                            isButtonDisabled
                                ? 'bg-gray-700 text-gray-400 cursor-not-allowed opacity-60'
                                : showWarning
                                    ? 'bg-amber-500 text-black hover:bg-amber-400 shadow-[0_0_20px_rgba(251,191,36,0.4)]'
                                    : 'bg-gradient-to-r from-cyan-500 to-cyan-400 text-black hover:from-cyan-400 hover:to-cyan-300 shadow-[0_0_25px_rgba(0,255,255,0.5)] hover:shadow-[0_0_35px_rgba(0,255,255,0.7)]'
                        }`}
                        data-testid="submit-offer-btn"
                    >
                        {isValidating ? (
                            <span className="flex items-center gap-2">
                                <Loader2 className="animate-spin" size={18} />
                                SUBMITTING...
                            </span>
                        ) : balanceLoading ? (
                            <span className="flex items-center gap-2">
                                <Loader2 className="animate-spin" size={18} />
                                LOADING...
                            </span>
                        ) : !isConnected ? (
                            'CONNECT WALLET'
                        ) : showWarning ? (
                            'SUBMIT ANYWAY'
                        ) : (
                            <span className="flex items-center gap-2">
                                <Gavel size={18} />
                                SUBMIT OFFER
                            </span>
                        )}
                    </Button>
                </DialogFooter>
            </DialogContent>
        </Dialog>
    );
}


=== ALSO ADD THIS IMPORT at the top of EscrowMarketplace.tsx if not already present ===

Make sure these are imported at the top with other imports:
- Loader2 (from lucide-react)
- Timer (from lucide-react)  
- Gavel (from lucide-react)

Check the existing imports - Loader2 and Gavel should already be there, just add Timer if missing.


=== KEY FIXES EXPLAINED ===

1. **Duration Dropdown Fixed**:
   - Added `position="popper"` and `sideOffset={4}` to SelectContent
   - Set explicit z-index: 999999 on SelectContent (higher than modal)
   - Changed duration state to use simple number strings ("7") instead of text ("1 week")
   - Added getDurationLabel() helper to display user-friendly labels

2. **Submit Button Now Visible & Bright**:
   - Gradient background: from-cyan-500 to-cyan-400
   - Glowing shadow effect: shadow-[0_0_25px_rgba(0,255,255,0.5)]
   - Increased size: h-12 and text-base
   - Clear hover states with stronger glow
   - Shows loading spinner when submitting

3. **Submit Button Now Works**:
   - Added console.log statements to track button clicks
   - Removed overly restrictive disabled conditions
   - Button is only disabled when: not connected, loading balance, or actively validating
   - Shows "CONNECT WALLET" text when not connected (still clickable to trigger connect)
   - Shows "SUBMIT ANYWAY" when funds are low but still allows submission
   - Clear validation error messages displayed to user

4. **Better UX**:
   - Timer icon in duration dropdown
   - Gavel icon in submit button
   - Loading spinners during async operations
   - Error shake animation
   - Better color coding (cyan theme throughout)