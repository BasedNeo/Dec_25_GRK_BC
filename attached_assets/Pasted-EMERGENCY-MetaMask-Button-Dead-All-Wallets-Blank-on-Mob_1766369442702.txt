EMERGENCY: MetaMask Button Dead + All Wallets Blank on Mobile

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ROOT CAUSE ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MetaMask button does nothing when clicked = Click event blocked OR connector misconfigured
"All Wallets" opens but blank = WalletConnect API cannot be reached (CORS/Network/Project ID issue)

Trust/Coinbase/Uniswap work = Those connectors are properly configured


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 1: COMPLETELY REBUILD WAGMI CONFIG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: client/src/lib/wagmi.ts

DELETE everything and REPLACE with this mobile-optimized configuration:

import { getDefaultConfig } from '@rainbow-me/rainbowkit';
import { defineChain } from 'viem';

export const basedaiChain = defineChain({
  id: 8453082024,
  name: 'BasedAI L1',
  nativeCurrency: {
    name: 'BASED',
    symbol: 'BASED',
    decimals: 18,
  },
  rpcUrls: {
    default: {
      http: ['https://rpc.basedai.network'],
    },
    public: {
      http: ['https://rpc.basedai.network'],
    },
  },
  blockExplorers: {
    default: {
      name: 'BasedAI Explorer',
      url: 'https://explorer.basedai.network',
    },
  },
  testnet: false,
});

// CRITICAL: Use getDefaultConfig for automatic mobile optimization
export const config = getDefaultConfig({
  appName: 'Based Guardians',
  projectId: '25a4673950aaa1276b2fa76417ef9633',
  chains: [basedaiChain],
  ssr: false,
  
  // CRITICAL: DO NOT set autoConnect on mobile
  autoConnect: false,
});


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 2: ADD EMERGENCY CSS FOR BUTTON CLICKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: client/src/index.css

ADD this at the VERY END of the file (AFTER the existing wallet CSS):

/* ========================================
   EMERGENCY: FORCE WALLET BUTTONS CLICKABLE
   ======================================== */

/* Force ALL RainbowKit buttons to receive clicks */
div[data-rk] button,
div[data-rk] button *,
div[data-rk] [role="dialog"] button,
div[data-rk] [role="dialog"] button * {
  pointer-events: auto !important;
  -webkit-tap-highlight-color: rgba(6, 182, 212, 0.3) !important;
  touch-action: manipulation !important;
}

/* CRITICAL: Prevent button children from blocking clicks */
div[data-rk] button * {
  pointer-events: none !important;
}

/* CRITICAL: Ensure button itself receives clicks */
div[data-rk] button {
  pointer-events: auto !important;
  cursor: pointer !important;
  position: relative !important;
  z-index: 1 !important;
}

/* CRITICAL: Force wallet list container to be visible */
div[data-rk] [data-testid="wallet-list"],
div[data-rk] [data-testid="rk-wallet-list"] {
  min-height: 200px !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* CRITICAL: Show loading state if wallets not loaded */
div[data-rk] [data-testid="wallet-list"]:empty::before,
div[data-rk] [data-testid="rk-wallet-list"]:empty::before {
  content: "Loading wallets..." !important;
  display: block !important;
  padding: 40px 20px !important;
  text-align: center !important;
  color: #666 !important;
  font-size: 14px !important;
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 3: ADD CRITICAL DIAGNOSTICS TO APP.TSX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: client/src/App.tsx

FIND the existing useEffect blocks and ADD this NEW one at the top (after imports):

import { useConnect } from 'wagmi';

function App() {
  const { connectors } = useConnect();

  // CRITICAL: Diagnostic logging for mobile wallet issues
  useEffect(() => {
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ” WALLET CONNECTION DIAGNOSTICS');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('Platform:', isMobile ? 'MOBILE' : 'DESKTOP');
    console.log('User Agent:', navigator.userAgent);
    console.log('');
    
    console.log('ğŸ“± Available Connectors:');
    connectors.forEach((connector, i) => {
      console.log(`  ${i + 1}. ${connector.name}`, {
        id: connector.id,
        ready: connector.ready,
        type: connector.type,
      });
    });
    console.log('');
    
    // CRITICAL: Test WalletConnect API accessibility
    console.log('ğŸ”— Testing WalletConnect API...');
    
    const testUrl = 'https://explorer-api.walletconnect.com/v3/wallets?projectId=25a4673950aaa1276b2fa76417ef9633';
    
    fetch(testUrl, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
      },
    })
      .then(response => {
        console.log('  Response Status:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('  âœ… WalletConnect API ACCESSIBLE');
        console.log('  Total Wallets:', Object.keys(data.listings || {}).length);
        
        // Check for MetaMask
        const wallets = Object.values(data.listings || {}) as any[];
        const metaMask = wallets.find(w => 
          w.name?.toLowerCase().includes('metamask')
        );
        
        if (metaMask) {
          console.log('  âœ… MetaMask Found:', {
            id: metaMask.id,
            name: metaMask.name,
            mobile: metaMask.mobile_link || 'N/A',
          });
        } else {
          console.log('  âš ï¸ MetaMask NOT in registry');
        }
      })
      .catch(error => {
        console.error('  âŒ WalletConnect API ERROR:', error.message);
        console.error('  This is why "All Wallets" shows BLANK!');
        console.error('  Possible causes:');
        console.error('    - CORS blocking the request');
        console.error('    - Network/firewall blocking walletconnect.com');
        console.error('    - Invalid Project ID');
      });
    
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  }, [connectors]);

  // REST OF YOUR APP CODE...
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 4: ADD CLICK EVENT LOGGER FOR WALLET BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: client/src/App.tsx

ADD this ADDITIONAL useEffect (separate from the one above):

useEffect(() => {
  // Log all wallet button clicks to diagnose dead buttons
  function logWalletButtonClick(e: MouseEvent) {
    const target = e.target as HTMLElement;
    const button = target.closest('button');
    
    if (button && button.closest('[data-rk]')) {
      const buttonText = button.textContent?.trim() || 'Unknown';
      
      console.log('ğŸ–±ï¸ WALLET BUTTON CLICKED:');
      console.log('  Button text:', buttonText);
      console.log('  Target element:', target.tagName);
      console.log('  Default prevented:', e.defaultPrevented);
      console.log('  Propagation stopped:', e.cancelBubble);
      console.log('  Button disabled:', button.disabled);
      console.log('  Button pointer-events:', getComputedStyle(button).pointerEvents);
      
      if (buttonText.toLowerCase().includes('metamask')) {
        console.log('  ğŸ¦Š MetaMask button clicked!');
        console.log('  Checking if MetaMask app is available...');
        
        // Check if we're in MetaMask mobile browser
        if (window.ethereum?.isMetaMask) {
          console.log('  âœ… In MetaMask browser');
        } else {
          console.log('  âŒ Not in MetaMask browser - will need deep link');
        }
      }
      
      if (buttonText.toLowerCase().includes('all') || buttonText.toLowerCase().includes('wallet')) {
        console.log('  ğŸ“‹ All Wallets button clicked!');
        console.log('  Modal should open with wallet list...');
        
        // Check if wallet list loads after 2 seconds
        setTimeout(() => {
          const walletList = document.querySelector('[data-testid="wallet-list"], [data-testid="rk-wallet-list"]');
          if (walletList) {
            const walletCount = walletList.querySelectorAll('button').length;
            console.log(`  Found ${walletCount} wallets in list`);
            
            if (walletCount === 0) {
              console.error('  âŒ Wallet list is EMPTY (this is the problem!)');
            }
          } else {
            console.error('  âŒ Wallet list element not found');
          }
        }, 2000);
      }
    }
  }
  
  // Capture phase to catch event before RainbowKit
  document.addEventListener('click', logWalletButtonClick, true);
  
  return () => {
    document.removeEventListener('click', logWalletButtonClick, true);
  };
}, []);


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 5: VERIFY RAINBOWKIT PROVIDER CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: client/src/main.tsx

FIND the RainbowKitProvider and ensure it has these props:

<RainbowKitProvider
  modalSize="compact"
  theme={darkTheme({
    accentColor: '#06b6d4',
    accentColorForeground: 'white',
    borderRadius: 'large',
  })}
  appInfo={{
    appName: 'Based Guardians',
  }}
>
  <App />
</RainbowKitProvider>


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 6: UPDATE SERVER CORS TO ALLOW WALLETCONNECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: server/index.ts

FIND where CORS is configured and UPDATE to include WalletConnect domains:

import cors from 'cors';

app.use(cors({
  origin: [
    'http://localhost:5173',
    'http://localhost:5000',
    'https://*.replit.app',
    'https://*.repl.co',
    'https://explorer-api.walletconnect.com',
    'https://relay.walletconnect.com',
    /\.walletconnect\.com$/,
    /\.walletconnect\.org$/,
  ],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS', 'HEAD'],
  allowedHeaders: ['Content-Type', 'Authorization', 'Accept'],
  exposedHeaders: ['Content-Length', 'X-Request-Id'],
}));


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 7: ADD CSP HEADERS FOR WALLETCONNECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

File: server/index.ts

ADD this middleware BEFORE your routes:

// Allow WalletConnect to load resources
app.use((req, res, next) => {
  res.setHeader(
    'Content-Security-Policy',
    "default-src 'self'; " +
    "connect-src 'self' https://*.basedai.network https://*.walletconnect.com https://*.walletconnect.org wss://*.walletconnect.com https://explorer-api.walletconnect.com https://relay.walletconnect.com https://*.coingecko.com; " +
    "img-src 'self' data: https: blob:; " +
    "script-src 'self' 'unsafe-inline' 'unsafe-eval'; " +
    "style-src 'self' 'unsafe-inline'; " +
    "font-src 'self' data: https:; " +
    "frame-src 'self' https:;"
  );
  next();
});


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 8: REBUILD AND TEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After making ALL changes above:

1. In Replit Shell, run:
   npm run build

2. Republish your app

3. On your mobile device:
   - Clear browser cache
   - Force close MetaMask app
   - Open app in Safari (iOS) or Chrome (Android)
   - Open browser dev tools if possible

4. Click "Connect Wallet"

5. Click MetaMask icon
   - Check browser console for: "ğŸ¦Š MetaMask button clicked!"
   - If you see this log, the button works
   - If you don't see this log, the button is still dead

6. Click "All Wallets" button
   - Check console for: "ğŸ“‹ All Wallets button clicked!"
   - Check console for: "âœ… WalletConnect API ACCESSIBLE"
   - If you see API error, the network is blocking WalletConnect


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
WHAT TO REPORT BACK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After testing, copy and paste these console logs:

1. The initial diagnostics section (starts with "WALLET CONNECTION DIAGNOSTICS")

2. When you click MetaMask button:
   - Did you see "ğŸ¦Š MetaMask button clicked!" in console? YES/NO
   - What happened after clicking? (nothing/app opened/error)

3. When you click "All Wallets":
   - Did you see "ğŸ“‹ All Wallets button clicked!" in console? YES/NO
   - Did you see "âœ… WalletConnect API ACCESSIBLE" or "âŒ WalletConnect API ERROR"?
   - Did wallet list show wallets or stay blank?

4. Copy and paste ALL console errors (the red text)

5. What mobile browser are you using? Safari/Chrome/other?

6. Is MetaMask app installed on your phone? YES/NO


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IF STILL BROKEN AFTER THIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If MetaMask button still does nothing:
- The click event is being blocked somewhere
- OR the connector isn't configured
- Console logs will show us WHY

If "All Wallets" still blank:
- WalletConnect API is being blocked
- Console logs will show: "âŒ WalletConnect API ERROR"
- This means network/CORS is blocking explorer-api.walletconnect.com

Copy and paste ALL console logs so I can see exactly what's failing.