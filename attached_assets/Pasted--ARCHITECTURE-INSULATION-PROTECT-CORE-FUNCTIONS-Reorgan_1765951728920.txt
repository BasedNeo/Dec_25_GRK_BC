=== ARCHITECTURE INSULATION - PROTECT CORE FUNCTIONS ===

Reorganize the codebase to isolate core commerce and game code from future updates.
This prevents accidental breaking changes.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 1: CREATE PROTECTED CORE FOLDER STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create this folder structure (move existing files):

/client/src/
â”œâ”€â”€ core/                          â† PROTECTED: Do not modify without review
â”‚   â”œâ”€â”€ README.md                  â† Documents what's protected and why
â”‚   â”œâ”€â”€ contracts/                 â† Contract ABIs and addresses
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ abis.ts
â”‚   â”œâ”€â”€ commerce/                  â† Minting, marketplace, offers
â”‚   â”‚   â”œâ”€â”€ useMint.ts
â”‚   â”‚   â”œâ”€â”€ useMarketplace.ts
â”‚   â”‚   â””â”€â”€ useOffers.ts
â”‚   â”œâ”€â”€ auth/                      â† Wallet connection, access control
â”‚   â”‚   â”œâ”€â”€ useWalletAuth.ts
â”‚   â”‚   â””â”€â”€ useIsGuardianHolder.ts
â”‚   â””â”€â”€ types.ts                   â† Shared TypeScript interfaces
â”‚
â”œâ”€â”€ game/                          â† ISOLATED: Self-contained game module
â”‚   â”œâ”€â”€ engine/
â”‚   â”‚   â”œâ”€â”€ gameEngine.ts
â”‚   â”‚   â””â”€â”€ gameRenderer.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useGameAccess.ts
â”‚   â”‚   â””â”€â”€ useGameScores.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ GuardianDefender.tsx
â”‚   â””â”€â”€ index.ts                   â† Single export point
â”‚
â”œâ”€â”€ features/                      â† MODULAR: New features go here
â”‚   â”œâ”€â”€ messaging/
â”‚   â”œâ”€â”€ leaderboard/
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ ui/                            â† SAFE: UI components, styling

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 2: CREATE CORE README (PROTECTION DOCUMENTATION)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE FILE: /client/src/core/README.md

# ğŸ”’ PROTECTED CORE - READ BEFORE MODIFYING

This folder contains **mission-critical commerce functions** that have been tested
and verified to work correctly. Modifications require careful review.

## âš ï¸ MODIFICATION RULES

1. **NEVER modify without creating a backup first**
2. **Test ALL commerce functions after any change**
3. **Document any changes in the changelog below**

## ğŸ“¦ What's Protected

| File | Purpose | Last Verified |
|------|---------|---------------|
| `commerce/useMint.ts` | NFT minting (8M gas) | [DATE] |
| `commerce/useMarketplace.ts` | Listings, buying | [DATE] |
| `commerce/useOffers.ts` | V3 offer system | [DATE] |
| `contracts/index.ts` | Contract addresses | [DATE] |
| `auth/useIsGuardianHolder.ts` | NFT gate check | [DATE] |

## ğŸ§ª Required Tests After Changes

- [ ] Mint 1 NFT successfully
- [ ] List NFT for sale
- [ ] Buy listed NFT
- [ ] Make offer (V3 signature)
- [ ] Cancel offer
- [ ] Game gate blocks non-holders
- [ ] Game gate allows holders

## ğŸ“ Changelog

| Date | Change | Author |
|------|--------|--------|
| [DATE] | Initial protection setup | - |â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 3: CREATE CORE TYPES (IMMUTABLE CONTRACTS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE FILE: /client/src/core/types.ts

/**
 * ğŸ”’ PROTECTED: These types define the interface contracts.
 * Changing these may break dependent code.
 */

// === COMMERCE TYPES ===
export interface MintResult {
  success: boolean;
  txHash?: string;
  tokenId?: number;
  error?: string;
}

export interface ListingData {
  tokenId: number;
  price: bigint;
  seller: `0x${string}`;
  active: boolean;
}

export interface OfferData {
  id: string;
  tokenId: number;
  amount: bigint;
  buyer: `0x${string}`;
  expiration: number;
  status: 'pending' | 'accepted' | 'completed' | 'expired' | 'cancelled';
  signature?: string;
  message?: string;
}

// === GAME TYPES ===
export interface GameAccessState {
  canPlay: boolean;
  reason: string;
  playsRemaining: number;
  cooldownSeconds: number;
}

export interface PlayerStats {
  lifetimeScore: number;
  bestScore: number;
  gamesPlayed: number;
  rank: string;
}

// === AUTH TYPES ===
export interface WalletState {
  address: `0x${string}` | undefined;
  isConnected: boolean;
  isHolder: boolean;
  balance: bigint;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 4: CREATE FEATURE FLAGS SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE FILE: /client/src/lib/featureFlags.ts

/**
 * Feature flags allow enabling/disabling features without code changes.
 * Toggle features for testing, gradual rollout, or emergency shutoff.
 */

interface FeatureFlags {
  // Commerce
  mintingEnabled: boolean;
  marketplaceEnabled: boolean;
  offersV3Enabled: boolean;
  
  // Game
  gameEnabled: boolean;
  gameLeaderboardEnabled: boolean;
  
  // Messaging
  offerMessagingEnabled: boolean;
  
  // Debug
  debugMode: boolean;
  showDiagnostics: boolean;
}

// Default production flags
const PRODUCTION_FLAGS: FeatureFlags = {
  mintingEnabled: true,
  marketplaceEnabled: true,
  offersV3Enabled: true,
  gameEnabled: true,
  gameLeaderboardEnabled: true,
  offerMessagingEnabled: true,
  debugMode: false,
  showDiagnostics: false,
};

// Override from localStorage for testing
function getFlags(): FeatureFlags {
  const stored = localStorage.getItem('feature_flags');
  if (stored) {
    try {
      return { ...PRODUCTION_FLAGS, ...JSON.parse(stored) };
    } catch {}
  }
  return PRODUCTION_FLAGS;
}

export const flags = getFlags();

// Admin function to toggle flags
export function setFlag(key: keyof FeatureFlags, value: boolean): void {
  const current = getFlags();
  current[key] = value;
  localStorage.setItem('feature_flags', JSON.stringify(current));
  window.location.reload(); // Reload to apply
}

// Hook for components
export function useFeatureFlags() {
  return flags;
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 5: CREATE CORE BARREL EXPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATE FILE: /client/src/core/index.ts

/**
 * ğŸ”’ CORE MODULE EXPORTS
 * Import from here, not from individual files.
 * This creates a stable API boundary.
 */

// Types (frozen contracts)
export * from './types';

// Commerce hooks
export { useMint } from './commerce/useMint';
export { useMarketplace } from './commerce/useMarketplace';
export { useOffers } from './commerce/useOffers';

// Auth hooks
export { useIsGuardianHolder } from './auth/useIsGuardianHolder';

// Contracts
export { NFT_CONTRACT, MARKETPLACE_CONTRACT, MARKETPLACE_V3_CONTRACT } from './contracts';

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 6: UPDATE IMPORTS THROUGHOUT APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After moving files, update all imports to use the barrel:

BEFORE:
import { useMint } from '@/hooks/useMint';
import { NFT_CONTRACT } from '@/lib/constants';

AFTER:
import { useMint, NFT_CONTRACT } from '@/core';

This creates a stable import path that won't break.