## REMOVE ALL DEMO DATA - MAKE PORTFOLIO SHOW ONLY REAL OWNED NFTs

Create 1 new file and update 1 existing file to make the Portfolio show ONLY NFTs actually owned by the connected wallet.

---

## NEW FILE: Create `client/src/hooks/useOwnedNFTs.ts`

import { useState, useEffect, useCallback } from 'react';
import { useAccount } from 'wagmi';
import { ethers } from 'ethers';
import { NFT_CONTRACT, RPC_URL, IPFS_ROOT } from '@/lib/constants';
import { Guardian } from '@/lib/mockData';

const NFT_ABI = [
  'function tokensOfOwner(address owner) view returns (uint256[])',
  'function tokenURI(uint256 tokenId) view returns (string)',
  'function balanceOf(address owner) view returns (uint256)',
];

export function useOwnedNFTs() {
  const { address, isConnected } = useAccount();
  const [nfts, setNfts] = useState<Guardian[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [balance, setBalance] = useState(0);

  const fetchOwnedNFTs = useCallback(async () => {
    if (!address || !isConnected) { setNfts([]); setBalance(0); return; }
    setIsLoading(true);
    setError(null);

    try {
      const provider = new ethers.JsonRpcProvider(RPC_URL);
      const contract = new ethers.Contract(NFT_CONTRACT, NFT_ABI, provider);
      const balanceBigInt = await contract.balanceOf(address);
      const userBalance = Number(balanceBigInt);
      setBalance(userBalance);

      if (userBalance === 0) { setNfts([]); setIsLoading(false); return; }

      let tokenIds: number[] = [];
      try {
        const tokenIdsBigInt = await contract.tokensOfOwner(address);
        tokenIds = tokenIdsBigInt.map((id: bigint) => Number(id));
      } catch (e) {
        setError('Could not fetch owned tokens');
        setIsLoading(false);
        return;
      }

      const fetchedNFTs: Guardian[] = [];
      for (const tokenId of tokenIds) {
        try {
          let uri = '';
          try { uri = await contract.tokenURI(tokenId); } catch (e) { uri = ''; }

          let metadataUrl = uri;
          if (!uri) metadataUrl = `${IPFS_ROOT}${tokenId}.json`;
          else if (uri.startsWith('ipfs://')) metadataUrl = uri.replace('ipfs://', 'https://ipfs.io/ipfs/');

          let metadata: any = { name: `Guardian #${tokenId}`, attributes: [] };
          try {
            const res = await fetch(metadataUrl);
            if (res.ok) metadata = await res.json();
          } catch (e) {}

          let imageUrl = metadata.image || '';
          if (imageUrl.startsWith('ipfs://')) imageUrl = imageUrl.replace('ipfs://', 'https://ipfs.io/ipfs/');
          if (!imageUrl) imageUrl = `https://moccasin-key-flamingo-487.mypinata.cloud/ipfs/bafybeif47552u34c3r46iy3p26h7j3a7b63d333p4m4r4v3r4b6x3d3d3y/${tokenId}.png`;

          const rarityAttr = metadata.attributes?.find((a: any) => a.trait_type === 'Rarity' || a.trait_type === 'Rarity Level');

          fetchedNFTs.push({
            id: tokenId,
            name: metadata.name || `Guardian #${tokenId}`,
            image: imageUrl,
            rarity: rarityAttr?.value || 'Common',
            owner: address,
            traits: metadata.attributes?.map((a: any) => ({ type: a.trait_type, value: String(a.value) })) || [],
          });
        } catch (e) {}
      }
      setNfts(fetchedNFTs);
    } catch (e: any) {
      setError(e.message || 'Failed to fetch owned NFTs');
    } finally {
      setIsLoading(false);
    }
  }, [address, isConnected]);

  useEffect(() => { fetchOwnedNFTs(); }, [fetchOwnedNFTs]);

  return { nfts, isLoading, error, balance, refetch: fetchOwnedNFTs };
}

---

## UPDATE: `client/src/components/NFTGallery.tsx`

Make these 7 changes:

### 1. Add import at top:
import { useOwnedNFTs } from "@/hooks/useOwnedNFTs";

### 2. Add hook call after the existing useState declarations (around line 65):
const { nfts: ownedNFTs, isLoading: isLoadingOwned, balance: nftBalance, refetch: refetchOwned } = useOwnedNFTs();

### 3. Replace the displayNfts line (around line 145):
FIND: const displayNfts = (nfts && nfts.length > 0) ? nfts : (useMockData ? MOCK_GUARDIANS : []);
REPLACE: const displayNfts = filterByOwner ? ownedNFTs : (nfts && nfts.length > 0) ? nfts : [];

### 4. Update the isLoading check (around line 472):
FIND: {isLoading && !displayNfts.length && !useMockData ? (
REPLACE: {(filterByOwner ? isLoadingOwned : isLoading) && !displayNfts.length ? (

### 5. DELETE the demo data toggle buttons entirely (around lines 342-358):
Delete this whole block:
<div className="flex items-center justify-center md:justify-end gap-2 w-full">
   <Button ... onClick={() => setUseCsvData(!useCsvData)} ...>
       {useCsvData ? "Using Local CSV Data (Fast)" : "Switch to CSV"}
   </Button>
   <Button ... onClick={() => { setUseMockData(!useMockData); setUseCsvData(false); }} ...>
       {useMockData ? "Switch to Real" : "View Demo Data"}
   </Button>
</div>

### 6. Update empty state message (around line 485):
FIND: <p className="text-muted-foreground mb-4">No Guardians found matching criteria.</p>
REPLACE WITH:
{filterByOwner ? (
  <>
    <p className="text-muted-foreground mb-4">You don't own any Guardians yet.</p>
    <p className="text-xs text-muted-foreground/50 mb-6">Mint or buy NFTs to see them here.</p>
  </>
) : (
  <>
    <p className="text-muted-foreground mb-4">No Guardians found matching criteria.</p>
    <p className="text-xs text-muted-foreground/50 mb-6">Try broadening your search or clearing filters.</p>
  </>
)}

### 7. Update holdings value visibility (around line 251):
FIND: {isConnected && nfts.length > 0 && (
REPLACE: {isConnected && displayNfts.length > 0 && filterByOwner && (

---

## RESULT:

✅ Portfolio calls tokensOfOwner(address) to get REAL owned NFTs
✅ Shows "You don't own any Guardians yet" when wallet has 0 NFTs  
✅ Removes "View Demo Data" / "Switch to CSV" buttons
✅ Holdings value only shows for YOUR actual owned NFTs
✅ No more fake/mock NFTs displayed
✅ Collection browser still works normally